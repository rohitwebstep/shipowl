{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 6, "column": 0}, "map": {"version":3,"sources":[],"names":[],"mappings":"","debugId":null}},
    {"offset": {"line": 68, "column": 0}, "map": {"version":3,"sources":["file://D%3A/Webstep/Shipping%20OWL/2025/April/04/WOKRING/sleeping-owl/src/lib/prisma.ts"],"sourcesContent":["import { PrismaClient } from \"@prisma/client\";\r\n\r\nconst prisma = new PrismaClient();\r\n\r\nasync function connectToDatabase() {\r\n    try {\r\n        // Attempt to connect to the database\r\n        await prisma.$connect();\r\n        console.log(\"Database connection established successfully.\");\r\n    } catch (error) {\r\n        // If connection fails, log the error\r\n        console.error(\"Database connection failed:\", error);\r\n        // Avoid using process.exit in Edge Runtime\r\n        // Instead, you can throw an error to be handled by the calling code\r\n        throw new Error(\"Database connection failed\");\r\n    }\r\n}\r\n\r\nconnectToDatabase().catch((error) => {\r\n    // Handle any unhandled promise rejections here, if necessary\r\n    console.error(error);\r\n    // You can choose to return a response or perform other actions instead of exiting\r\n});\r\n\r\nexport default prisma;\r\n"],"names":[],"mappings":";;;AAAA;;AAEA,MAAM,SAAS,IAAI,6HAAA,CAAA,eAAY;AAE/B,eAAe;IACX,IAAI;QACA,qCAAqC;QACrC,MAAM,OAAO,QAAQ;QACrB,QAAQ,GAAG,CAAC;IAChB,EAAE,OAAO,OAAO;QACZ,qCAAqC;QACrC,QAAQ,KAAK,CAAC,+BAA+B;QAC7C,2CAA2C;QAC3C,oEAAoE;QACpE,MAAM,IAAI,MAAM;IACpB;AACJ;AAEA,oBAAoB,KAAK,CAAC,CAAC;IACvB,6DAA6D;IAC7D,QAAQ,KAAK,CAAC;AACd,kFAAkF;AACtF;uCAEe","debugId":null}},
    {"offset": {"line": 131, "column": 0}, "map": {"version":3,"sources":["file://D%3A/Webstep/Shipping%20OWL/2025/April/04/WOKRING/sleeping-owl/src/utils/authUtils.ts"],"sourcesContent":["import jwt from 'jsonwebtoken';\r\nimport { jwtVerify } from 'jose';\r\nimport prisma from \"@/lib/prisma\";\r\n\r\nconst SECRET_KEY = process.env.JWT_SECRET || '3792e68ef011e0f236a60627ddf304e1bb64d76d5e4dbebca4579490d3c4e6d8c618456f29aa6f92f8dc3cbd4414362b47d4545ffdc0b9549e43b629c39282bb36b9cff7295fc4269d765d59e4d8a811113b911080878f7647e0329a072afdc06d2ecd658c8e79f2ad04e74dbffc45ed10c850b02afdf10b209989910fadaf7ddbef0bb7d0cff27ed8f4a10d3415420107ddba2d9ac8bcf4f7b3b942b5bbe600d9007f9e88b2451cbfaeaab239677b3ed28eaa860eb40fd5d0e36969b6943a3215d2a9f1125ca06be806f8d73d8ae642c4a29b3a728cf42305e1150e4c1f3ed6e14bd3662531cd14357c6b3f3a57095609811f5e9459307cbe70f9b7a159c8d3';\r\n\r\nexport function generateToken(userId: number, userRole: string) {\r\n    return jwt.sign({ userId, userRole }, SECRET_KEY, { expiresIn: '1h' });\r\n}\r\n\r\nexport async function verifyToken(token: string) {\r\n    try {\r\n        const { payload } = await jwtVerify(token, new TextEncoder().encode(SECRET_KEY));\r\n        console.log(`payload - `, payload);\r\n        return payload;\r\n    } catch (error) {\r\n        console.error('Token verification failed:', error);\r\n        return null;\r\n    }\r\n}\r\n\r\n// Check if user exists in the database\r\nexport async function isUserExist(userId: number) {\r\n    try {\r\n        // Fetch user details from database\r\n        const user = await prisma.user.findUnique({\r\n            where: { id: userId },\r\n            select: {\r\n                id: true,\r\n                name: true,\r\n                email: true,\r\n                password: true, // Hashed password stored in DB\r\n                role: true,\r\n            },\r\n        });\r\n\r\n        // If user doesn't exist, return false with a message\r\n        if (!user) {\r\n            return { status: false, message: \"User with the provided ID does not exist\" };\r\n        }\r\n\r\n        // Return user details if found\r\n        return { status: true, user };\r\n    } catch (error) {\r\n        console.error(\"Error fetching user by ID:\", error);\r\n        return { status: false, message: \"Internal Server Error\" };\r\n    }\r\n}"],"names":[],"mappings":";;;;;AAAA;AACA;AACA;;;;AAEA,MAAM,aAAa,QAAQ,GAAG,CAAC,UAAU,IAAI;AAEtC,SAAS,cAAc,MAAc,EAAE,QAAgB;IAC1D,OAAO,uIAAA,CAAA,UAAG,CAAC,IAAI,CAAC;QAAE;QAAQ;IAAS,GAAG,YAAY;QAAE,WAAW;IAAK;AACxE;AAEO,eAAe,YAAY,KAAa;IAC3C,IAAI;QACA,MAAM,EAAE,OAAO,EAAE,GAAG,MAAM,CAAA,GAAA,yJAAA,CAAA,YAAS,AAAD,EAAE,OAAO,IAAI,cAAc,MAAM,CAAC;QACpE,QAAQ,GAAG,CAAC,CAAC,UAAU,CAAC,EAAE;QAC1B,OAAO;IACX,EAAE,OAAO,OAAO;QACZ,QAAQ,KAAK,CAAC,8BAA8B;QAC5C,OAAO;IACX;AACJ;AAGO,eAAe,YAAY,MAAc;IAC5C,IAAI;QACA,mCAAmC;QACnC,MAAM,OAAO,MAAM,sHAAA,CAAA,UAAM,CAAC,IAAI,CAAC,UAAU,CAAC;YACtC,OAAO;gBAAE,IAAI;YAAO;YACpB,QAAQ;gBACJ,IAAI;gBACJ,MAAM;gBACN,OAAO;gBACP,UAAU;gBACV,MAAM;YACV;QACJ;QAEA,qDAAqD;QACrD,IAAI,CAAC,MAAM;YACP,OAAO;gBAAE,QAAQ;gBAAO,SAAS;YAA2C;QAChF;QAEA,+BAA+B;QAC/B,OAAO;YAAE,QAAQ;YAAM;QAAK;IAChC,EAAE,OAAO,OAAO;QACZ,QAAQ,KAAK,CAAC,8BAA8B;QAC5C,OAAO;YAAE,QAAQ;YAAO,SAAS;QAAwB;IAC7D;AACJ","debugId":null}},
    {"offset": {"line": 202, "column": 0}, "map": {"version":3,"sources":["file://D%3A/Webstep/Shipping%20OWL/2025/April/04/WOKRING/sleeping-owl/src/app/api/admin/auth/verify/route.ts"],"sourcesContent":["import { NextRequest, NextResponse } from 'next/server';\r\nimport prisma from \"@/lib/prisma\";\r\nimport { verifyToken } from '@/utils/authUtils';\r\n\r\nexport async function GET(req: NextRequest) {\r\n    try {\r\n        // Extract token from Authorization header\r\n        const token = req.headers.get('authorization')?.split(' ')[1];\r\n        if (!token) {\r\n            return NextResponse.json({ error: 'No token provided' }, { status: 401 });\r\n        }\r\n\r\n        // Verify token and extract user details\r\n        const decodedUser = await verifyToken(token);\r\n        console.log(`Decoded User: `, decodedUser); // Log the decoded user for debugging\r\n        if (!decodedUser || typeof decodedUser.userId !== 'number') {\r\n            return NextResponse.json({ error: \"Invalid token\" }, { status: 403 });\r\n        }\r\n\r\n        // Determine the user model based on role\r\n        const userModel = [\"admin\", \"dropshipper\", \"supplier\"].includes(decodedUser.adminRole) ? \"user\" : \"userStaff\";\r\n\r\n        // Fetch the user from the database\r\n        let user = await prisma[userModel].findUnique({\r\n            where: { id: decodedUser.userId }, // Primary key lookup\r\n            select: {\r\n                id: true,\r\n                name: true,\r\n                email: true,\r\n                role: true,\r\n                createdAt: true,\r\n            },\r\n        });\r\n\r\n        if (!user) {\r\n            return NextResponse.json({ error: \"Invalid email or password\" }, { status: 401 });\r\n        }\r\n\r\n        return NextResponse.json({ message: \"Token is valid\", user });\r\n    } catch (error) {\r\n        console.error(`error - `, error);\r\n        return NextResponse.json({ error: \"Internal Server Error\" }, { status: 500 });\r\n    }\r\n}\r\n"],"names":[],"mappings":";;;AAAA;AACA;AACA;;;;AAEO,eAAe,IAAI,GAAgB;IACtC,IAAI;QACA,0CAA0C;QAC1C,MAAM,QAAQ,IAAI,OAAO,CAAC,GAAG,CAAC,kBAAkB,MAAM,IAAI,CAAC,EAAE;QAC7D,IAAI,CAAC,OAAO;YACR,OAAO,gIAAA,CAAA,eAAY,CAAC,IAAI,CAAC;gBAAE,OAAO;YAAoB,GAAG;gBAAE,QAAQ;YAAI;QAC3E;QAEA,wCAAwC;QACxC,MAAM,cAAc,MAAM,CAAA,GAAA,2HAAA,CAAA,cAAW,AAAD,EAAE;QACtC,QAAQ,GAAG,CAAC,CAAC,cAAc,CAAC,EAAE,cAAc,qCAAqC;QACjF,IAAI,CAAC,eAAe,OAAO,YAAY,MAAM,KAAK,UAAU;YACxD,OAAO,gIAAA,CAAA,eAAY,CAAC,IAAI,CAAC;gBAAE,OAAO;YAAgB,GAAG;gBAAE,QAAQ;YAAI;QACvE;QAEA,yCAAyC;QACzC,MAAM,YAAY;YAAC;YAAS;YAAe;SAAW,CAAC,QAAQ,CAAC,YAAY,SAAS,IAAI,SAAS;QAElG,mCAAmC;QACnC,IAAI,OAAO,MAAM,sHAAA,CAAA,UAAM,CAAC,UAAU,CAAC,UAAU,CAAC;YAC1C,OAAO;gBAAE,IAAI,YAAY,MAAM;YAAC;YAChC,QAAQ;gBACJ,IAAI;gBACJ,MAAM;gBACN,OAAO;gBACP,MAAM;gBACN,WAAW;YACf;QACJ;QAEA,IAAI,CAAC,MAAM;YACP,OAAO,gIAAA,CAAA,eAAY,CAAC,IAAI,CAAC;gBAAE,OAAO;YAA4B,GAAG;gBAAE,QAAQ;YAAI;QACnF;QAEA,OAAO,gIAAA,CAAA,eAAY,CAAC,IAAI,CAAC;YAAE,SAAS;YAAkB;QAAK;IAC/D,EAAE,OAAO,OAAO;QACZ,QAAQ,KAAK,CAAC,CAAC,QAAQ,CAAC,EAAE;QAC1B,OAAO,gIAAA,CAAA,eAAY,CAAC,IAAI,CAAC;YAAE,OAAO;QAAwB,GAAG;YAAE,QAAQ;QAAI;IAC/E;AACJ","debugId":null}}]
}