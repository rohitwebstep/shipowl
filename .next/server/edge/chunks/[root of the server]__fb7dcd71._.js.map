{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 23, "column": 0}, "map": {"version":3,"sources":["turbopack:///[project]/src/middlewares/adminAuth.ts"],"sourcesContent":["// src/adminAuthMiddleware.ts\r\nimport { NextRequest, NextResponse } from \"next/server\";\r\nimport { jwtVerify } from 'jose';\r\n\r\nconst SECRET_KEY = process.env.JWT_SECRET || '3792e68ef011e0f236a60627ddf304e1bb64d76d5e4dbebca4579490d3c4e6d8c618456f29aa6f92f8dc3cbd4414362b47d4545ffdc0b9549e43b629c39282bb36b9cff7295fc4269d765d59e4d8a811113b911080878f7647e0329a072afdc06d2ecd658c8e79f2ad04e74dbffc45ed10c850b02afdf10b209989910fadaf7ddbef0bb7d0cff27ed8f4a10d3415420107ddba2d9ac8bcf4f7b3b942b5bbe600d9007f9e88b2451cbfaeaab239677b3ed28eaa860eb40fd5d0e36969b6943a3215d2a9f1125ca06be806f8d73d8ae642c4a29b3a728cf42305e1150e4c1f3ed6e14bd3662531cd14357c6b3f3a57095609811f5e9459307cbe70f9b7a159c8d3';\r\n\r\nexport async function adminAuthMiddleware(req: NextRequest, adminRole: string, applicableRoles: string[]) {\r\n    try {\r\n        // Extract token from Authorization header\r\n        const token = req.headers.get(\"authorization\")?.split(\" \")[1];\r\n        if (!token) {\r\n            return NextResponse.json({ error: \"Access denied. Please log in to continue.\" }, { status: 401 });\r\n        }\r\n\r\n        // Verify token and extract admin details\r\n        const { payload } = await jwtVerify(token, new TextEncoder().encode(SECRET_KEY));\r\n        if (!payload || typeof payload !== 'object' || typeof payload.adminId !== 'number' || typeof payload.adminRole !== 'string') {\r\n            return NextResponse.json({ error: \"Access forbidden. Invalid token payload.\" }, { status: 403 });\r\n        } else if (!applicableRoles.includes(payload.adminRole)) {\r\n            return NextResponse.json({ error: \"Access denied. Admin privileges required.\" }, { status: 403 });\r\n        }\r\n\r\n        // Clone the request and set custom headers\r\n        const response = NextResponse.next();\r\n        response.headers.set(`x-${adminRole}-id`, payload.adminId.toString());\r\n        response.headers.set(`x-${adminRole}-role`, payload.adminRole.toString());\r\n\r\n        return response;\r\n    } catch (error) {\r\n        console.error(`error - `, error);\r\n        let message = \"Authentication failed. Please try again.\";\r\n\r\n        if (typeof error === \"object\" && error !== null && \"code\" in error) {\r\n            const err = error as { code: string };\r\n            if (err.code === 'ERR_JWT_EXPIRED') {\r\n                message = \"Session expired. Please log in again.\";\r\n            }\r\n        }\r\n        return NextResponse.json({ error: message }, { status: 401 });\r\n    }\r\n}\r\n"],"names":[],"mappings":"AAAA,6BAA6B;;;;AAC7B;AAAA;AACA;;;AAEA,MAAM,aAAa,QAAQ,GAAG,CAAC,UAAU,IAAI;AAEtC,eAAe,oBAAoB,GAAgB,EAAE,SAAiB,EAAE,eAAyB;IACpG,IAAI;QACA,0CAA0C;QAC1C,MAAM,QAAQ,IAAI,OAAO,CAAC,GAAG,CAAC,kBAAkB,MAAM,IAAI,CAAC,EAAE;QAC7D,IAAI,CAAC,OAAO;YACR,OAAO,6LAAA,CAAA,eAAY,CAAC,IAAI,CAAC;gBAAE,OAAO;YAA4C,GAAG;gBAAE,QAAQ;YAAI;QACnG;QAEA,yCAAyC;QACzC,MAAM,EAAE,OAAO,EAAE,GAAG,MAAM,CAAA,GAAA,+JAAA,CAAA,YAAS,AAAD,EAAE,OAAO,IAAI,cAAc,MAAM,CAAC;QACpE,IAAI,CAAC,WAAW,OAAO,YAAY,YAAY,OAAO,QAAQ,OAAO,KAAK,YAAY,OAAO,QAAQ,SAAS,KAAK,UAAU;YACzH,OAAO,6LAAA,CAAA,eAAY,CAAC,IAAI,CAAC;gBAAE,OAAO;YAA2C,GAAG;gBAAE,QAAQ;YAAI;QAClG,OAAO,IAAI,CAAC,gBAAgB,QAAQ,CAAC,QAAQ,SAAS,GAAG;YACrD,OAAO,6LAAA,CAAA,eAAY,CAAC,IAAI,CAAC;gBAAE,OAAO;YAA4C,GAAG;gBAAE,QAAQ;YAAI;QACnG;QAEA,2CAA2C;QAC3C,MAAM,WAAW,6LAAA,CAAA,eAAY,CAAC,IAAI;QAClC,SAAS,OAAO,CAAC,GAAG,CAAC,CAAC,EAAE,EAAE,UAAU,GAAG,CAAC,EAAE,QAAQ,OAAO,CAAC,QAAQ;QAClE,SAAS,OAAO,CAAC,GAAG,CAAC,CAAC,EAAE,EAAE,UAAU,KAAK,CAAC,EAAE,QAAQ,SAAS,CAAC,QAAQ;QAEtE,OAAO;IACX,EAAE,OAAO,OAAO;QACZ,QAAQ,KAAK,CAAC,CAAC,QAAQ,CAAC,EAAE;QAC1B,IAAI,UAAU;QAEd,IAAI,OAAO,UAAU,YAAY,UAAU,QAAQ,UAAU,OAAO;YAChE,MAAM,MAAM;YACZ,IAAI,IAAI,IAAI,KAAK,mBAAmB;gBAChC,UAAU;YACd;QACJ;QACA,OAAO,6LAAA,CAAA,eAAY,CAAC,IAAI,CAAC;YAAE,OAAO;QAAQ,GAAG;YAAE,QAAQ;QAAI;IAC/D;AACJ"}},
    {"offset": {"line": 86, "column": 0}, "map": {"version":3,"sources":["turbopack:///[project]/src/middleware.ts"],"sourcesContent":["// src/middleware.ts\r\nimport { NextRequest, NextResponse } from \"next/server\";\r\nimport { adminAuthMiddleware } from \"./middlewares/adminAuth\";  // Import admin middleware\r\n\r\nexport function middleware(req: NextRequest) {\r\n    const res = NextResponse.next();\r\n    // Apply CORS headers globally\r\n    res.headers.set(\"Access-Control-Allow-Origin\", \"*\");  // Change '*' to your frontend URL in production\r\n    res.headers.set(\"Access-Control-Allow-Methods\", \"GET, POST, OPTIONS\");\r\n    res.headers.set(\"Access-Control-Allow-Headers\", \"Content-Type, Authorization\");\r\n\r\n    // Handle preflight requests\r\n    if (req.method === \"OPTIONS\") {\r\n        return new Response(null, { status: 200, headers: res.headers });\r\n    }\r\n\r\n    // Apply adminAuthMiddleware to /api/admin/list route\r\n    const adminProtectedRoutes = [\"/api/admin/list\", \"/api/admin/auth/verify\"];\r\n    const dropshipperProtectedRoutes = [\"/api/dropshipper/list\", \"/api/dropshipper/auth/verify\"];\r\n    const supplierProtectedRoutes = [\"/api/supplier/list\", \"/api/supplier/auth/verify\"];\r\n\r\n    if (adminProtectedRoutes.some(route => req.url.includes(route))) {\r\n        const applicableRoles = [\"admin\", \"admin_staff\"];\r\n        const adminRole = \"admin\";\r\n        return adminAuthMiddleware(req, adminRole, applicableRoles);\r\n    }\r\n\r\n    if (dropshipperProtectedRoutes.some(route => req.url.includes(route))) {\r\n        const applicableRoles = [\"dropshipper\", \"dropshipper_staff\"];\r\n        const adminRole = \"dropshipper\";\r\n        return adminAuthMiddleware(req, adminRole, applicableRoles);\r\n    }\r\n\r\n    if (supplierProtectedRoutes.some(route => req.url.includes(route))) {\r\n        const applicableRoles = [\"supplier\", \"supplier_staff\"];\r\n        const adminRole = \"supplier\";\r\n        return adminAuthMiddleware(req, adminRole, applicableRoles);\r\n    }\r\n\r\n    return req;  // Continue processing for other routes\r\n}\r\n\r\n// Define the matcher for specific routes\r\nexport const config = {\r\n    matcher: [\"/api/admin/list\", \"/api/admin/auth/verify\", \"/api/dropshipper/list\", \"/api/dropshipper/auth/verify\", \"/api/supplier/list\", \"/api/supplier/auth/verify\"],\r\n};\r\n"],"names":[],"mappings":"AAAA,oBAAoB;;;;;AACpB;AAAA;AACA,gPAAgE,0BAA0B;;;AAEnF,SAAS,WAAW,GAAgB;IACvC,MAAM,MAAM,6LAAA,CAAA,eAAY,CAAC,IAAI;IAC7B,8BAA8B;IAC9B,IAAI,OAAO,CAAC,GAAG,CAAC,+BAA+B,MAAO,gDAAgD;IACtG,IAAI,OAAO,CAAC,GAAG,CAAC,gCAAgC;IAChD,IAAI,OAAO,CAAC,GAAG,CAAC,gCAAgC;IAEhD,4BAA4B;IAC5B,IAAI,IAAI,MAAM,KAAK,WAAW;QAC1B,OAAO,IAAI,SAAS,MAAM;YAAE,QAAQ;YAAK,SAAS,IAAI,OAAO;QAAC;IAClE;IAEA,qDAAqD;IACrD,MAAM,uBAAuB;QAAC;QAAmB;KAAyB;IAC1E,MAAM,6BAA6B;QAAC;QAAyB;KAA+B;IAC5F,MAAM,0BAA0B;QAAC;QAAsB;KAA4B;IAEnF,IAAI,qBAAqB,IAAI,CAAC,CAAA,QAAS,IAAI,GAAG,CAAC,QAAQ,CAAC,SAAS;QAC7D,MAAM,kBAAkB;YAAC;YAAS;SAAc;QAChD,MAAM,YAAY;QAClB,OAAO,CAAA,GAAA,uIAAA,CAAA,sBAAmB,AAAD,EAAE,KAAK,WAAW;IAC/C;IAEA,IAAI,2BAA2B,IAAI,CAAC,CAAA,QAAS,IAAI,GAAG,CAAC,QAAQ,CAAC,SAAS;QACnE,MAAM,kBAAkB;YAAC;YAAe;SAAoB;QAC5D,MAAM,YAAY;QAClB,OAAO,CAAA,GAAA,uIAAA,CAAA,sBAAmB,AAAD,EAAE,KAAK,WAAW;IAC/C;IAEA,IAAI,wBAAwB,IAAI,CAAC,CAAA,QAAS,IAAI,GAAG,CAAC,QAAQ,CAAC,SAAS;QAChE,MAAM,kBAAkB;YAAC;YAAY;SAAiB;QACtD,MAAM,YAAY;QAClB,OAAO,CAAA,GAAA,uIAAA,CAAA,sBAAmB,AAAD,EAAE,KAAK,WAAW;IAC/C;IAEA,OAAO,KAAM,uCAAuC;AACxD;AAGO,MAAM,SAAS;IAClB,SAAS;QAAC;QAAmB;QAA0B;QAAyB;QAAgC;QAAsB;KAA4B;AACtK"}}]
}